# Simple workflow for deploying static content to GitHub Pages
name: Deploy static content to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["master", "development"]
  pull_request:
    branches: [master, development]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

# jobs:
#   # Single deploy job since we're just deploying
#   deploy:
#     environment:
#       name: github-pages
#       url: ${{ steps.deployment.outputs.page_url }}
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v4
#       - name: Setup Pages
#         uses: actions/configure-pages@v5
#       - name: Upload artifact
#         uses: actions/upload-pages-artifact@v3
#         with:
#           # Upload entire repository
#           path: '.'
#       - name: Deploy to GitHub Pages
#         id: deployment
#         uses: actions/deploy-pages@v4


jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # ── Your build steps here ──

      # Decide path & branch
      - name: Determine deploy target
        id: target
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/master" ]]; then
            echo "dest_dir=." >> $GITHUB_OUTPUT           # root
            echo "deploy_branch=gh-pages" >> $GITHUB_OUTPUT
          else
            BRANCH_NAME=${GITHUB_REF#refs/heads/}
            SAFE_BRANCH=${BRANCH_NAME//\//-}              # feature/xyz → feature-xyz
            echo "dest_dir=$SAFE_BRANCH/" >> $GITHUB_OUTPUT
            echo "deploy_branch=gh-pages" >> $GITHUB_OUTPUT
          fi
      # ── The magic happens here ──
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: projects/periodic table                   # ← your build output directory
          branch: development                # ← target branch (must match Pages setting)
          target-folder: ${{ steps.target.outputs.subfolder }}
          clean: true                     # recommended – removes old files
          clean-exclude: |                # optional: protect some files/folders
            CNAME
            .nojekyll
